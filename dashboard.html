
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>케미테스트 - 프로젝트 대시보드</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="data/constants.js"></script>
    <script src="data/subjects/human.js"></script>
    <script src="data/subjects/cat.js"></script>
    <script src="data/subjects/dog.js"></script>
    <script src="data/subjects/rabbit.js"></script>
    <script src="data/subjects/hamster.js"></script>
    <script src="data/subjects/idealType.js"></script>
    <script src="data/subjects/petMatch.js"></script>
    <script src="data/subjects/plant.js"></script>
    <script src="data/subjects/coffee.js"></script>
    <script src="data/index.js"></script>
    <script src="data/config.js"></script>
    <script src="data/utils.js"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    animation: {
                        'fade-in': 'fadeIn 0.3s ease-out',
                        'slide-up': 'slideUp 0.4s ease-out',
                        'pulse-slow': 'pulse 3s ease-in-out infinite',
                        'float': 'float 3s ease-in-out infinite',
                    }
                }
            }
        }
    </script>
    <style>
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }

        .glass { background: white; border: 1px solid #e2e8f0; }
        .dark .glass { background: #1e293b; border: 1px solid #334155; }
        .gradient-bg { background: linear-gradient(135deg, #3b82f6 0%, #6366f1 100%); }
        .gradient-card { background: linear-gradient(135deg, rgba(59,130,246,.05) 0%, rgba(99,102,241,.05) 100%); }

        .sidebar { transition: width 0.3s ease, transform 0.3s ease; }
        .sidebar.collapsed { width: 80px; }
        .sidebar.collapsed .nav-text { display: none; }
        .nav-item { transition: all 0.2s ease; }
        .nav-item:hover { transform: translateX(4px); }
        .nav-item.active { background: linear-gradient(135deg, #3b82f6 0%, #6366f1 100%); color: white; box-shadow: 0 4px 12px rgba(59,130,246,0.3); }
        .dark .nav-item.active { box-shadow: 0 4px 12px rgba(59,130,246,0.25); }
        .stat-card { transition: all 0.3s ease; }
        .stat-card:hover { transform: translateY(-4px); box-shadow: 0 20px 40px rgba(0,0,0,0.1); }
        .dark .stat-card:hover { box-shadow: 0 20px 40px rgba(0,0,0,0.3); }
        .progress-bar { background: linear-gradient(90deg, #3b82f6 0%, #6366f1 100%); transition: width 0.6s ease; }
        .table-row { transition: all 0.2s ease; }
        .table-row:hover { background: rgba(59,130,246,0.05); }
        .dark .table-row:hover { background: rgba(59,130,246,0.1); }
        .mode-btn { transition: all 0.2s ease; }
        .mode-btn.active { background: linear-gradient(135deg, #3b82f6 0%, #6366f1 100%); color: white; box-shadow: 0 4px 12px rgba(59,130,246,0.3); }
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-thumb { background: rgba(59,130,246,0.3); border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: rgba(59,130,246,0.5); }
    </style>
</head>
<body class="bg-slate-100 dark:bg-slate-900 min-h-screen transition-colors duration-300">
    <button onclick="toggleSidebar()" class="md:hidden fixed top-4 left-4 z-50 p-2 rounded-lg glass">
        <svg class="w-6 h-6 text-slate-700 dark:text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg>
    </button>

    <aside id="sidebar" class="sidebar fixed left-0 top-0 h-full w-64 glass z-40 flex flex-col">
        <div class="p-6 border-b border-slate-200/50 dark:border-slate-700/50">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 rounded-xl gradient-bg flex items-center justify-center animate-float">
                    <span class="text-white text-xl">🧭</span>
                </div>
                <div class="nav-text">
                    <h1 class="font-bold text-slate-800 dark:text-white">케미테스트</h1>
                    <p class="text-xs text-slate-500 dark:text-slate-400">프로젝트 대시보드</p>
                </div>
            </div>
        </div>

        <nav class="flex-1 p-4 space-y-2">
            <button onclick="showTab('overview')" id="nav-overview" class="nav-item active w-full flex items-center gap-3 px-4 py-3 rounded-xl text-left">
                <span class="text-xl">📊</span><span class="nav-text font-medium">개요</span>
            </button>
            <button onclick="showTab('management')" id="nav-management" class="nav-item w-full flex items-center gap-3 px-4 py-3 rounded-xl text-left text-slate-600 dark:text-slate-300 hover:bg-slate-200/50 dark:hover:bg-slate-700/50">
                <span class="text-xl">❓</span><span class="nav-text font-medium">테스트 관리</span>
            </button>
            <button onclick="showTab('logic')" id="nav-logic" class="nav-item w-full flex items-center gap-3 px-4 py-3 rounded-xl text-left text-slate-600 dark:text-slate-300 hover:bg-slate-200/50 dark:hover:bg-slate-700/50">
                <span class="text-xl">⚙️</span><span class="nav-text font-medium">결과 로직</span>
            </button>
            <button onclick="showTab('simulator')" id="nav-simulator" class="nav-item w-full flex items-center gap-3 px-4 py-3 rounded-xl text-left text-slate-600 dark:text-slate-300 hover:bg-slate-200/50 dark:hover:bg-slate-700/50">
                <span class="text-xl">🧪</span><span class="nav-text font-medium">시뮬레이터</span>
            </button>
            <button onclick="showTab('architecture')" id="nav-architecture" class="nav-item w-full flex items-center gap-3 px-4 py-3 rounded-xl text-left text-slate-600 dark:text-slate-300 hover:bg-slate-200/50 dark:hover:bg-slate-700/50">
                <span class="text-xl">🏗️</span><span class="nav-text font-medium">아키텍처</span>
            </button>
            <button onclick="showTab('design')" id="nav-design" class="nav-item w-full flex items-center gap-3 px-4 py-3 rounded-xl text-left text-slate-600 dark:text-slate-300 hover:bg-slate-200/50 dark:hover:bg-slate-700/50">
                <span class="text-xl">🎨</span><span class="nav-text font-medium">디자인 시스템</span>
            </button>
            <button onclick="showTab('dev')" id="nav-dev" class="nav-item w-full flex items-center gap-3 px-4 py-3 rounded-xl text-left text-slate-600 dark:text-slate-300 hover:bg-slate-200/50 dark:hover:bg-slate-700/50">
                <span class="text-xl">🛠️</span><span class="nav-text font-medium">개발</span>
            </button>
            <button onclick="showTab('roadmap')" id="nav-roadmap" class="nav-item w-full flex items-center gap-3 px-4 py-3 rounded-xl text-left text-slate-600 dark:text-slate-300 hover:bg-slate-200/50 dark:hover:bg-slate-700/50">
                <span class="text-xl">🚀</span><span class="nav-text font-medium">로드맵</span>
            </button>
            <button onclick="showTab('learn')" id="nav-learn" class="nav-item w-full flex items-center gap-3 px-4 py-3 rounded-xl text-left text-slate-600 dark:text-slate-300 hover:bg-slate-200/50 dark:hover:bg-slate-700/50">
                <span class="text-xl">📚</span><span class="nav-text font-medium">학습</span>
            </button>
        </nav>

        <div class="p-4 border-t border-slate-200/50 dark:border-slate-700/50">
            <button onclick="toggleDarkMode()" class="w-full flex items-center gap-3 px-4 py-3 rounded-xl text-slate-600 dark:text-slate-300 hover:bg-slate-200/50 dark:hover:bg-slate-700/50 transition">
                <span class="text-xl" id="theme-icon">☀️</span>
                <span class="nav-text font-medium" id="theme-text">라이트 모드</span>
            </button>
        </div>
    </aside>

    <div id="overlay" onclick="toggleSidebar()" class="md:hidden fixed inset-0 bg-black/50 z-30 hidden"></div>

    <main class="main-content md:ml-64 p-4 md:p-8 min-h-screen transition-all duration-300">
        <div id="panel-overview" class="tab-panel animate-fade-in">
            <div class="mb-8">
                <h2 class="text-2xl md:text-3xl font-bold text-slate-800 dark:text-white mb-2">대시보드 개요</h2>
                <p class="text-slate-500 dark:text-slate-400">9개 테스트의 질문·로직·시뮬레이션 현황을 한눈에 확인하세요.</p>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-4 mb-8">
                <div class="stat-card bg-gradient-to-br from-slate-800 to-slate-900 dark:from-slate-700 dark:to-slate-800 rounded-2xl p-6 text-white">
                    <div class="flex items-center justify-between mb-4">
                        <span class="text-3xl">📊</span>
                        <span class="text-xs font-medium px-3 py-1 rounded-full bg-white/20">전체 통계</span>
                    </div>
                    <div class="text-4xl font-bold mb-1" id="stat-total">0</div>
                    <div class="text-sm text-slate-300">총 질문 수</div>
                    <div class="mt-4 pt-4 border-t border-white/10 flex justify-between text-xs text-slate-300">
                        <span id="stat-tests">0개 테스트</span>
                        <span id="stat-results">0개 결과</span>
                    </div>
                </div>
                <div class="stat-card glass rounded-2xl p-6">
                    <h4 class="text-sm font-bold text-slate-700 dark:text-slate-200 mb-2">테스트 카테고리</h4>
                    <div class="flex items-center gap-3">
                        <div class="w-12 h-12 rounded-2xl bg-blue-50 dark:bg-blue-900/30 flex items-center justify-center text-2xl">🧭</div>
                        <div class="flex-1">
                            <p class="text-sm text-slate-500 dark:text-slate-400">성격형 / 매칭형</p>
                            <p class="font-bold text-slate-800 dark:text-white"><span id="stat-personality">-</span> · <span id="stat-matching">-</span></p>
                        </div>
                    </div>
                    <p class="text-xs text-slate-500 dark:text-slate-400 mt-2">SUBJECT_CONFIG 기반 분류</p>
                </div>
                <div class="stat-card glass rounded-2xl p-6">
                    <h4 class="text-sm font-bold text-slate-700 dark:text-slate-200 mb-2">체크리스트</h4>
                    <ul class="text-sm text-slate-600 dark:text-slate-300 space-y-1">
                        <li>✅ 디자인 시스템 반영</li>
                        <li>✅ 아키텍처·데이터 스키마</li>
                        <li>✅ 코딩 규칙·테스트·환경</li>
                        <li>✅ 9개 테스트 로드맵</li>
                    </ul>
                </div>
            </div>
            <div class="glass rounded-2xl p-6">
                <div class="flex items-center justify-between mb-4">
                    <div>
                        <h3 class="text-lg font-bold text-slate-800 dark:text-white">9개 테스트 현황</h3>
                        <p class="text-sm text-slate-500 dark:text-slate-400">질문 수 · 결과 라벨 · 테스트 유형</p>
                    </div>
                    <span class="text-xs px-3 py-1 rounded-full bg-indigo-100 text-indigo-700 dark:bg-indigo-900/40 dark:text-indigo-200">자동 집계</span>
                </div>
                <div id="overview-test-grid" class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-4"></div>
            </div>
        </div>

        <div id="panel-management" class="tab-panel hidden">
            <div class="mb-8">
                <h2 class="text-2xl md:text-3xl font-bold text-slate-800 dark:text-white mb-2">테스트 관리</h2>
                <p class="text-slate-500 dark:text-slate-400">9개 테스트 버튼으로 질문·차원·답변 배점을 탐색하세요.</p>
            </div>
            <div id="management-modes" class="flex gap-2 mb-6 flex-wrap"></div>
            <div class="glass rounded-2xl overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead>
                            <tr class="border-b border-slate-200 dark:border-slate-700">
                                <th class="px-4 py-4 text-left text-sm font-bold text-slate-600 dark:text-slate-300">#</th>
                                <th class="px-4 py-4 text-left text-sm font-bold text-slate-600 dark:text-slate-300">유형</th>
                                <th class="px-4 py-4 text-left text-sm font-bold text-slate-600 dark:text-slate-300">차원</th>
                                <th class="px-4 py-4 text-left text-sm font-bold text-slate-600 dark:text-slate-300">질문</th>
                                <th class="px-4 py-4 text-left text-sm font-bold text-slate-600 dark:text-slate-300">배점 (점수)</th>
                            </tr>
                        </thead>
                        <tbody id="management-table"></tbody>
                    </table>
                </div>
            </div>
        </div>
        <div id="panel-logic" class="tab-panel hidden">
            <div class="mb-8">
                <h2 class="text-2xl md:text-3xl font-bold text-slate-800 dark:text-white mb-2">결과 로직</h2>
                <p class="text-slate-500 dark:text-slate-400">결과 라벨과 조건을 테스트별로 비교하세요.</p>
            </div>
            <div id="logic-modes" class="flex gap-2 mb-6 flex-wrap"></div>
            <div id="logic-results-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
        </div>

        <div id="panel-simulator" class="tab-panel hidden">
            <div class="mb-8">
                <h2 class="text-2xl md:text-3xl font-bold text-slate-800 dark:text-white mb-2">결과 시뮬레이터</h2>
                <p class="text-slate-500 dark:text-slate-400">점수를 조절해 즉시 결과를 확인하세요.</p>
            </div>
            <div class="glass rounded-2xl p-6">
                <div id="sim-modes" class="flex gap-2 mb-6 flex-wrap"></div>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div>
                        <h4 class="font-bold text-slate-700 dark:text-slate-200 mb-4 flex items-center gap-2"><span class="text-xl">🎚️</span> 차원별 배점 (%)</h4>
                        <div id="sim-sliders" class="space-y-6"></div>
                        <button onclick="simulate()" class="mt-6 w-full bg-gradient-to-r from-blue-500 to-indigo-600 text-white font-bold py-3 rounded-xl hover:opacity-90 transition shadow-lg shadow-blue-500/25">결과 확인</button>
                    </div>
                    <div>
                        <h4 class="font-bold text-slate-700 dark:text-slate-200 mb-4 flex items-center gap-2"><span class="text-xl">??</span> 예상 결과</h4>
                        <div id="sim-result" class="rounded-2xl bg-slate-50 dark:bg-slate-800/50 p-6 min-h-[300px] flex items-center justify-center">
                            <p class="text-slate-400 dark:text-slate-500 text-center">슬라이더를 조절하고<br>"결과 확인"을 눌러주세요.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="panel-architecture" class="tab-panel hidden">
            <div class="mb-8">
                <h2 class="text-2xl md:text-3xl font-bold text-slate-800 dark:text-white mb-2">아키텍처</h2>
                <p class="text-slate-500 dark:text-slate-400">폴더 구조, 컴포넌트, 서비스, 상태 흐름을 한 페이지에서 정리합니다.</p>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 mb-6">
                <div class="glass rounded-2xl p-6">
                    <h3 class="text-lg font-bold text-slate-800 dark:text-white mb-3 flex items-center gap-2"><span class="text-xl">🗂️</span> 폴더 구조</h3>
                    <ul class="text-sm text-slate-600 dark:text-slate-300 space-y-2">
                        <li><span class="font-bold text-slate-800 dark:text-white">data/</span> · subjects, constants, config, utils</li>
                        <li><span class="font-bold text-slate-800 dark:text-white">components/</span> · Icons, ModeTabs, TraitBar, TestHeader, InsightView</li>
                        <li><span class="font-bold text-slate-800 dark:text-white">services/</span> · ResultService, InsightService</li>
                        <li><span class="font-bold text-slate-800 dark:text-white">scripts/</span> · 데이터 검증·변환 스크립트 모음</li>
                    </ul>
                </div>
                <div class="glass rounded-2xl p-6">
                    <h3 class="text-lg font-bold text-slate-800 dark:text-white mb-3 flex items-center gap-2"><span class="text-xl">??</span> 컴포넌트 목록</h3>
                    <ul class="text-sm text-slate-600 dark:text-slate-300 space-y-2">
                        <li>App · 엔트리/상태 관리</li>
                        <li>ModeTabs · 탭 및 테스트 스위치</li>
                        <li>TestHeader · 요약/CTA</li>
                        <li>TraitBar · 차원 뱃지/진척도</li>
                        <li>InsightView · 결과/추천 UI</li>
                        <li>Icons · 테스트별 아이콘 세트</li>
                    </ul>
                </div>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 mb-6">
                <div class="glass rounded-2xl p-6">
                    <h3 class="text-lg font-bold text-slate-800 dark:text-white mb-3 flex items-center gap-2"><span class="text-xl">🛰️</span> 서비스 목록</h3>
                    <ul class="text-sm text-slate-600 dark:text-slate-300 space-y-2">
                        <li><span class="font-bold">ResultService</span> · saveResult, getMyResults, getRecommendedTest, getIncompleteTests, syncPending</li>
                        <li><span class="font-bold">InsightService</span> · generateInsights, getRecommendations, normalizeScore</li>
                        <li class="text-xs text-slate-400 dark:text-slate-500">Supabase 예정: StorageProviders.supabase(저장/동기화)</li>
                    </ul>
                </div>
                <div class="glass rounded-2xl p-6">
                    <h3 class="text-lg font-bold text-slate-800 dark:text-white mb-3 flex items-center gap-2"><span class="text-xl">??</span> 상태 관리</h3>
                    <ul class="text-sm text-slate-600 dark:text-slate-300 space-y-2">
                        <li>React useState 로컬 상태 (테스트 선택, 점수, 결과)</li>
                        <li>window.resultService / window.insightService 전역 주입</li>
                        <li>localStorage 저장 → 추후 Supabase 연동 시 동기화</li>
                        <li>서비스 흐름: 질문 응답 → 결과 저장 → 인사이트 생성</li>
                    </ul>
                </div>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
                <div class="glass rounded-2xl p-6">
                    <h3 class="text-lg font-bold text-slate-800 dark:text-white mb-3 flex items-center gap-2"><span class="text-xl">??</span> 데이터 스키마</h3>
                    <ul class="text-sm text-slate-600 dark:text-slate-300 space-y-2">
                        <li>localStorage key: <code class="text-xs bg-slate-100 dark:bg-slate-800 px-2 py-1 rounded">chemi_results</code></li>
                        <li>필드: testType, resultLabel, scores, createdAt, userId</li>
                        <li>Supabase(예정): tables <code class="text-xs bg-slate-100 dark:bg-slate-800 px-2 py-1 rounded">results</code>, <code class="text-xs bg-slate-100 dark:bg-slate-800 px-2 py-1 rounded">insights</code></li>
                        <li>SUBJECT_CONFIG: testType, icon, label, resultFormat, matchPointsTitle, colors</li>
                    </ul>
                </div>
                <div class="glass rounded-2xl p-6">
                    <h3 class="text-lg font-bold text-slate-800 dark:text-white mb-3 flex items-center gap-2"><span class="text-xl">??</span> API / 서비스 흐름</h3>
                    <ul class="text-sm text-slate-600 dark:text-slate-300 space-y-2">
                        <li>ResultService.save → localStorage / Supabase 저장</li>
                        <li>ResultService.getRecommendedTest → 완료/미완료 테스트 탐색</li>
                        <li>InsightService.generateInsights → 결과 그룹핑/추천</li>
                        <li>SW sync 이벤트 수신 → pending 데이터 업로드</li>
                    </ul>
                </div>
            </div>
        </div>

        <div id="panel-design" class="tab-panel hidden">
            <div class="mb-8">
                <h2 class="text-2xl md:text-3xl font-bold text-slate-800 dark:text-white mb-2">디자인 시스템</h2>
                <p class="text-slate-500 dark:text-slate-400">컬러·타입·UI·애니메이션·이모지를 통합 관리합니다.</p>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 mb-4">
                <div class="glass rounded-2xl p-6">
                    <h3 class="text-lg font-bold text-slate-800 dark:text-white mb-4 flex items-center gap-2"><span class="text-xl">??</span> 컬러</h3>
                    <ul class="text-sm text-slate-600 dark:text-slate-300 space-y-2">
                        <li>브랜드: gradient Indigo → Purple (primary)</li>
                        <li>상태: HIGH(#10B981) / MED(#F59E0B) / LOW(#EF4444)</li>
                        <li>테스트별: Human(amber), Cat(rose), Dog(emerald), Rabbit(pink), Hamster(orange), IdealType(pink), Plant(green), Coffee(amber), PetMatch(yellow)</li>
                    </ul>
                </div>
                <div class="glass rounded-2xl p-6">
                    <h3 class="text-lg font-bold text-slate-800 dark:text-white mb-4 flex items-center gap-2"><span class="text-xl">??</span> 타이포그래피</h3>
                    <ul class="text-sm text-slate-600 dark:text-slate-300 space-y-2">
                        <li>Head: Jua 32/40, bold</li>
                        <li>Body: Jua 16/24, normal</li>
                        <li>Code/Meta: ui-monospace 13-14px</li>
                    </ul>
                </div>
            </div>
            <div class="glass rounded-2xl p-6 mb-4">
                <h3 class="text-lg font-bold text-slate-800 dark:text-white mb-4 flex items-center gap-2"><span class="text-xl">??</span> UI 컴포넌트</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm text-slate-600 dark:text-slate-300">
                    <div class="rounded-xl bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 p-4">
                        <p class="font-bold text-slate-800 dark:text-white mb-2">버튼</p>
                        <p>Primary, Ghost, Subtle / 12px radius / shadow-sm</p>
                    </div>
                    <div class="rounded-xl bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 p-4">
                        <p class="font-bold text-slate-800 dark:text-white mb-2">배지·카드</p>
                        <p>Rounded-full 상태 배지, glass 카드, gradient-card</p>
                    </div>
                    <div class="rounded-xl bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 p-4">
                        <p class="font-bold text-slate-800 dark:text-white mb-2">입력</p>
                        <p>12px radius, focus ring #6366F1, 모서리 그림자 최소화</p>
                    </div>
                </div>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
                <div class="glass rounded-2xl p-6">
                    <h3 class="text-lg font-bold text-slate-800 dark:text-white mb-3 flex items-center gap-2"><span class="text-xl">?</span> 애니메이션</h3>
                    <ul class="text-sm text-slate-600 dark:text-slate-300 space-y-2">
                        <li>fade-in, slide-up: 탭/카드 진입</li>
                        <li>float: 아이콘 강조</li>
                        <li>pulse-slow: 진행 상태 피드백</li>
                        <li>hover: scale 1.02, shadow-lg</li>
                    </ul>
                </div>
                <div class="glass rounded-2xl p-6">
                    <h3 class="text-lg font-bold text-slate-800 dark:text-white mb-3 flex items-center gap-2"><span class="text-xl">??</span> 이모지 가이드</h3>
                    <ul class="text-sm text-slate-600 dark:text-slate-300 space-y-2">
                        <li>모드: 📊 개요 · ❓ 관리 · ⚙️ 로직 · 🧪 시뮬 · 🏗️ 아키텍처 · 🎨 디자인 · 🛠️ 개발 · 🚀 로드맵</li>
                        <li>상태: ? 완료 · ?? 주의 · ?? 진행 · ?? 구성</li>
                        <li>액션: ? 추가 · ?? 저장 · ?? 검증 · ?? 확정</li>
                    </ul>
                </div>
            </div>
        </div>
        <div id="panel-dev" class="tab-panel hidden">
            <div class="mb-8">
                <h2 class="text-2xl md:text-3xl font-bold text-slate-800 dark:text-white mb-2">개발</h2>
                <p class="text-slate-500 dark:text-slate-400">코딩 규칙, 테스트, 환경 설정, 의존성을 한곳에.</p>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 mb-4">
                <div class="glass rounded-2xl p-6">
                    <h3 class="text-lg font-bold text-slate-800 dark:text-white mb-3 flex items-center gap-2"><span class="text-xl">??</span> 코딩 규칙</h3>
                    <ul class="text-sm text-slate-600 dark:text-slate-300 space-y-2">
                        <li>IIFE 패턴으로 window 노출 최소화</li>
                        <li>네이밍: camelCase(JS) / snake_case(DB)</li>
                        <li>방어적 코딩: null 체크, try/catch 로깅</li>
                        <li>UI 동작: 토글/탭 시 active 클래스 관리</li>
                    </ul>
                </div>
                <div class="glass rounded-2xl p-6">
                    <h3 class="text-lg font-bold text-slate-800 dark:text-white mb-3 flex items-center gap-2"><span class="text-xl">??</span> 테스트</h3>
                    <ul class="text-sm text-slate-600 dark:text-slate-300 space-y-2">
                        <li>node scripts/validate-questions.mjs</li>
                        <li>node scripts/check-similarity.mjs</li>
                        <li>node scripts/test-navigation.mjs</li>
                        <li>node scripts/test-insight-service.mjs</li>
                        <li class="text-xs text-amber-600 dark:text-amber-400">data.js 직접 수정 금지 → 스크립트로 변환</li>
                    </ul>
                </div>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 mb-4">
                <div class="glass rounded-2xl p-6">
                    <h3 class="text-lg font-bold text-slate-800 dark:text-white mb-3 flex items-center gap-2"><span class="text-xl">??</span> 환경 설정</h3>
                    <ul class="text-sm text-slate-600 dark:text-slate-300 space-y-2">
                        <li>CDN: React 18, ReactDOM 18, Babel standalone</li>
                        <li>스타일: Tailwind CDN + 커스텀 애니메이션</li>
                        <li>빌드/배포: 정적 html/js, PWA manifest, SW</li>
                        <li>데이터: localStorage 저장, 추후 Supabase 연동</li>
                    </ul>
                </div>
                <div class="glass rounded-2xl p-6">
                    <h3 class="text-lg font-bold text-slate-800 dark:text-white mb-3 flex items-center gap-2"><span class="text-xl">??</span> 의존성</h3>
                    <ul class="text-sm text-slate-600 dark:text-slate-300 space-y-2">
                        <li>React, ReactDOM, Babel</li>
                        <li>TailwindCSS</li>
                        <li>marked.js (문서 뷰어)</li>
                        <li>서비스: ResultService / InsightService</li>
                    </ul>
                </div>
            </div>
            <div class="glass rounded-2xl p-6 mb-4">
                <h3 class="text-lg font-bold text-slate-800 dark:text-white mb-3 flex items-center gap-2"><span class="text-xl">??</span> 문서 링크</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-3 text-sm text-slate-600 dark:text-slate-300">
                    <button onclick="openMarkdownViewer('docs/planning/QUESTION_BANK.md', 'QUESTION_BANK')" class="flex items-center gap-2 px-3 py-2 rounded-lg bg-slate-50 dark:bg-slate-800/50 hover:bg-slate-100 dark:hover:bg-slate-700 transition text-left"><span>??</span><span>QUESTION_BANK</span></button>
                    <button onclick="openMarkdownViewer('docs/design/PSYCHOLOGY_TEST_DESIGN_SYSTEM.md', 'DESIGN_SYSTEM')" class="flex items-center gap-2 px-3 py-2 rounded-lg bg-slate-50 dark:bg-slate-800/50 hover:bg-slate-100 dark:hover:bg-slate-700 transition text-left"><span>??</span><span>DESIGN_SYSTEM</span></button>
                    <button onclick="openMarkdownViewer('docs/research/QUESTION_COUNT_RESEARCH.md', 'QUESTION_COUNT_RESEARCH')" class="flex items-center gap-2 px-3 py-2 rounded-lg bg-slate-50 dark:bg-slate-800/50 hover:bg-slate-100 dark:hover:bg-slate-700 transition text-left"><span>??</span><span>QUESTION_COUNT_RESEARCH</span></button>
                    <button onclick="openMarkdownViewer('docs/LEGAL_COMPLIANCE.md', 'LEGAL_COMPLIANCE')" class="flex items-center gap-2 px-3 py-2 rounded-lg bg-slate-50 dark:bg-slate-800/50 hover:bg-slate-100 dark:hover:bg-slate-700 transition text-left"><span>??</span><span>LEGAL_COMPLIANCE</span></button>
                </div>
            </div>
            <div class="glass rounded-2xl p-6 border-2 border-red-200 dark:border-red-900">
                <div class="flex items-start gap-3">
                    <span class="text-2xl">??</span>
                    <div>
                        <h4 class="font-bold text-red-700 dark:text-red-400">data.js 직접 수정 금지</h4>
                        <p class="text-sm text-red-600 dark:text-red-300 mt-1">인코딩/정렬 오류 방지. 반드시 Node 스크립트로 추가·수정.</p>
                    </div>
                </div>
            </div>
        </div>

        <div id="panel-roadmap" class="tab-panel hidden">
            <div class="mb-8">
                <h2 class="text-2xl md:text-3xl font-bold text-slate-800 dark:text-white mb-2">로드맵</h2>
                <p class="text-slate-500 dark:text-slate-400">운영 중 테스트, 단계별 진행, 향후 계획을 정리합니다.</p>
            </div>
            <div class="glass rounded-2xl p-6 mb-6">
                <h3 class="text-lg font-bold text-slate-800 dark:text-white mb-4 flex items-center gap-2"><span class="text-xl">?</span> 운영 중 테스트 (9)</h3>
                <div id="roadmap-test-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4"></div>
            </div>
            <div class="glass rounded-2xl p-6 mb-6">
                <h3 class="text-lg font-bold text-slate-800 dark:text-white mb-4 flex items-center gap-2"><span class="text-xl">??</span> Phase 진행</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="rounded-xl bg-emerald-50 dark:bg-emerald-900/20 p-4 border border-emerald-200 dark:border-emerald-800">
                        <p class="text-xs font-bold text-emerald-700 dark:text-emerald-300 mb-1">Phase 1</p>
                        <p class="text-sm text-slate-700 dark:text-slate-200">데이터 정합성, 질문 검증 (완료)</p>
                    </div>
                    <div class="rounded-xl bg-blue-50 dark:bg-blue-900/20 p-4 border border-blue-200 dark:border-blue-800">
                        <p class="text-xs font-bold text-blue-700 dark:text-blue-300 mb-1">Phase 2</p>
                        <p class="text-sm text-slate-700 dark:text-slate-200">매칭형 3종 런칭, 시뮬레이터 고도화 (진행)</p>
                    </div>
                    <div class="rounded-xl bg-amber-50 dark:bg-amber-900/20 p-4 border border-amber-200 dark:border-amber-800">
                        <p class="text-xs font-bold text-amber-700 dark:text-amber-300 mb-1">Phase 3</p>
                        <p class="text-sm text-slate-700 dark:text-slate-200">Supabase 연동, 리포트 자동화 (예정)</p>
                    </div>
                    <div class="rounded-xl bg-slate-50 dark:bg-slate-800/50 p-4 border border-slate-200 dark:border-slate-700">
                        <p class="text-xs font-bold text-slate-700 dark:text-slate-200 mb-1">Phase 4</p>
                        <p class="text-sm text-slate-700 dark:text-slate-200">SDK/임베드, 다국어 확장 (예정)</p>
                    </div>
                </div>
            </div>
            <div class="glass rounded-2xl p-6">
                <h3 class="text-lg font-bold text-slate-800 dark:text-white mb-4 flex items-center gap-2"><span class="text-xl">??</span> 향후 계획</h3>
                <ul class="text-sm text-slate-600 dark:text-slate-300 space-y-2">
                    <li>· Supabase StorageProvider 정식 적용 및 동기화 알림</li>
                    <li>· 결과 리포트 PDF/이미지 내보내기</li>
                    <li>· 테스트별 A/B 실험과 베타 트래킹</li>
                    <li>· 임베디드 위젯/SDK로 외부 사이트 연동</li>
                </ul>
            </div>
        </div>

        <!-- 학습 탭 -->
        <div id="panel-learn" class="tab-panel hidden">
            <div class="mb-12">
                <h2 class="text-2xl font-semibold text-slate-900 dark:text-white mb-2">웹 개발 기초</h2>
                <p class="text-slate-500 dark:text-slate-400">이 프로젝트를 이해하기 위한 핵심 개념들</p>
            </div>

            <div class="space-y-12">
                <!-- JSX -->
                <section>
                    <div class="flex items-baseline gap-4 mb-4">
                        <span class="text-xs font-mono text-slate-400 dark:text-slate-500 tracking-wider">01</span>
                        <h3 class="text-lg font-medium text-slate-900 dark:text-white">JSX란?</h3>
                    </div>
                    <div class="pl-10">
                        <p class="text-slate-600 dark:text-slate-300 mb-6 leading-relaxed max-w-2xl">
                            HTML처럼 생긴 JavaScript 코드입니다. React에서 UI를 쉽게 작성하기 위해 만든 문법이에요.
                        </p>
                        <div class="grid md:grid-cols-2 gap-6 mb-6">
                            <div class="border-l-2 border-slate-900 dark:border-white pl-4">
                                <span class="text-[11px] font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider">JSX 문법</span>
                                <pre class="mt-3 text-sm text-slate-800 dark:text-slate-200 font-mono leading-relaxed"><code>&lt;button onClick={click}&gt;
  클릭
&lt;/button&gt;</code></pre>
                                <p class="mt-3 text-sm text-slate-500 dark:text-slate-400">직관적이고 읽기 쉬움</p>
                            </div>
                            <div class="border-l-2 border-slate-300 dark:border-slate-600 pl-4">
                                <span class="text-[11px] font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider">순수 JavaScript</span>
                                <pre class="mt-3 text-sm text-slate-600 dark:text-slate-400 font-mono leading-relaxed"><code>React.createElement(
  "button",
  {onClick: click},
  "클릭"
)</code></pre>
                                <p class="mt-3 text-sm text-slate-500 dark:text-slate-400">복잡하고 읽기 어려움</p>
                            </div>
                        </div>
                        <p class="text-sm text-slate-500 dark:text-slate-400 border-l-2 border-slate-200 dark:border-slate-700 pl-4 py-2">
                            <strong class="text-slate-700 dark:text-slate-300">참고:</strong> JSX는 JavaScript 표준이 아니라 React 전용 문법이라 브라우저가 직접 이해할 수 없습니다.
                        </p>
                    </div>
                </section>

                <hr class="border-slate-200 dark:border-slate-700/50">

                <!-- Babel -->
                <section>
                    <div class="flex items-baseline gap-4 mb-4">
                        <span class="text-xs font-mono text-slate-400 dark:text-slate-500 tracking-wider">02</span>
                        <h3 class="text-lg font-medium text-slate-900 dark:text-white">Babel이란?</h3>
                    </div>
                    <div class="pl-10">
                        <p class="text-slate-600 dark:text-slate-300 mb-6 leading-relaxed max-w-2xl">
                            JSX를 브라우저가 이해할 수 있는 순수 JavaScript로 번역해주는 번역기입니다.
                        </p>
                        <div class="flex items-center gap-4 py-6 overflow-x-auto">
                            <div class="flex-shrink-0 text-center">
                                <code class="text-sm font-mono text-slate-700 dark:text-slate-300">&lt;div/&gt;</code>
                                <p class="text-xs text-slate-400 mt-1">작성</p>
                            </div>
                            <span class="text-slate-300 dark:text-slate-600">→</span>
                            <div class="flex-shrink-0 text-center px-4 py-2 border border-slate-300 dark:border-slate-600 rounded">
                                <span class="text-sm font-medium text-slate-700 dark:text-slate-300">Babel</span>
                            </div>
                            <span class="text-slate-300 dark:text-slate-600">→</span>
                            <div class="flex-shrink-0 text-center">
                                <code class="text-sm font-mono text-slate-700 dark:text-slate-300">createElement()</code>
                                <p class="text-xs text-slate-400 mt-1">결과</p>
                            </div>
                        </div>
                        <p class="text-sm text-slate-500 dark:text-slate-400 border-l-2 border-slate-200 dark:border-slate-700 pl-4 py-2">
                            <strong class="text-slate-700 dark:text-slate-300">주의:</strong> 최신 브라우저도 JSX는 못 읽습니다. JSX는 JavaScript 표준이 아니라 React만의 특별한 문법이기 때문입니다.
                        </p>
                    </div>
                </section>

                <hr class="border-slate-200 dark:border-slate-700/50">

                <!-- CORS -->
                <section>
                    <div class="flex items-baseline gap-4 mb-4">
                        <span class="text-xs font-mono text-slate-400 dark:text-slate-500 tracking-wider">03</span>
                        <h3 class="text-lg font-medium text-slate-900 dark:text-white">CORS란?</h3>
                    </div>
                    <div class="pl-10">
                        <p class="text-slate-600 dark:text-slate-300 mb-6 leading-relaxed max-w-2xl">
                            브라우저의 보안 정책입니다. 다른 출처의 데이터를 함부로 가져오지 못하게 막습니다.
                        </p>
                        <div class="grid md:grid-cols-2 gap-6 mb-6">
                            <div class="border-l-2 border-slate-300 dark:border-slate-600 pl-4">
                                <div class="flex items-center gap-2 mb-2">
                                    <span class="text-slate-400">✕</span>
                                    <span class="text-[11px] font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider">file:// 프로토콜</span>
                                </div>
                                <code class="block text-xs font-mono text-slate-500 dark:text-slate-400 mb-2">file://C:/project/index.html</code>
                                <p class="text-sm text-slate-500 dark:text-slate-400">출처가 없어서 다른 파일 접근 차단</p>
                            </div>
                            <div class="border-l-2 border-slate-900 dark:border-white pl-4">
                                <div class="flex items-center gap-2 mb-2">
                                    <span class="text-slate-700 dark:text-slate-300">✓</span>
                                    <span class="text-[11px] font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider">http:// 프로토콜</span>
                                </div>
                                <code class="block text-xs font-mono text-slate-700 dark:text-slate-300 mb-2">http://localhost:8080</code>
                                <p class="text-sm text-slate-600 dark:text-slate-300">같은 서버 출처이므로 접근 허용</p>
                            </div>
                        </div>
                        <p class="text-sm text-slate-500 dark:text-slate-400 border-l-2 border-slate-200 dark:border-slate-700 pl-4 py-2">
                            <strong class="text-slate-700 dark:text-slate-300">왜 막을까?</strong> CORS가 없으면 악성 사이트가 당신 컴퓨터의 파일을 읽을 수 있습니다.
                        </p>
                    </div>
                </section>

                <hr class="border-slate-200 dark:border-slate-700/50">

                <!-- F12 개발자도구 -->
                <section>
                    <div class="flex items-baseline gap-4 mb-4">
                        <span class="text-xs font-mono text-slate-400 dark:text-slate-500 tracking-wider">04</span>
                        <h3 class="text-lg font-medium text-slate-900 dark:text-white">F12에서 보이는 것</h3>
                    </div>
                    <div class="pl-10">
                        <p class="text-slate-600 dark:text-slate-300 mb-6 leading-relaxed max-w-2xl">
                            개발자도구의 Elements 탭은 JSX 소스가 아니라, React가 만든 최종 HTML 결과물입니다.
                        </p>
                        <div class="flex items-center gap-3 py-6 overflow-x-auto text-sm">
                            <div class="flex-shrink-0 text-center">
                                <code class="font-mono text-slate-600 dark:text-slate-400">className</code>
                                <p class="text-xs text-slate-400 mt-1">1. JSX</p>
                            </div>
                            <span class="text-slate-300 dark:text-slate-600">→</span>
                            <div class="flex-shrink-0 text-center">
                                <span class="text-slate-600 dark:text-slate-400">Babel</span>
                                <p class="text-xs text-slate-400 mt-1">2. 변환</p>
                            </div>
                            <span class="text-slate-300 dark:text-slate-600">→</span>
                            <div class="flex-shrink-0 text-center">
                                <span class="text-slate-600 dark:text-slate-400">React</span>
                                <p class="text-xs text-slate-400 mt-1">3. 실행</p>
                            </div>
                            <span class="text-slate-300 dark:text-slate-600">→</span>
                            <div class="flex-shrink-0 text-center border-b-2 border-slate-900 dark:border-white pb-1">
                                <code class="font-mono text-slate-900 dark:text-white font-medium">class</code>
                                <p class="text-xs text-slate-600 dark:text-slate-300 mt-1">4. DOM</p>
                            </div>
                        </div>
                        <p class="text-sm text-slate-600 dark:text-slate-300">
                            F12에서 보이는 건 마지막 단계의 실제 DOM입니다.
                        </p>
                    </div>
                </section>

                <hr class="border-slate-200 dark:border-slate-700/50">

                <!-- 프로젝트 구조 -->
                <section>
                    <div class="flex items-baseline gap-4 mb-4">
                        <span class="text-xs font-mono text-slate-400 dark:text-slate-500 tracking-wider">05</span>
                        <h3 class="text-lg font-medium text-slate-900 dark:text-white">이 프로젝트의 실행 방식</h3>
                    </div>
                    <div class="pl-10">
                        <div class="grid md:grid-cols-3 gap-8">
                            <div>
                                <div class="flex items-center gap-3 mb-3">
                                    <span class="text-xs font-mono text-slate-400">A</span>
                                    <span class="font-medium text-slate-900 dark:text-white">index.html</span>
                                </div>
                                <p class="text-sm text-slate-500 dark:text-slate-400 mb-3">React + JSX 사용</p>
                                <code class="block text-xs font-mono text-slate-600 dark:text-slate-300 bg-slate-100 dark:bg-slate-800 px-3 py-2 rounded">npx live-server</code>
                                <p class="text-xs text-slate-400 mt-2">서버 필수</p>
                            </div>
                            <div>
                                <div class="flex items-center gap-3 mb-3">
                                    <span class="text-xs font-mono text-slate-400">B</span>
                                    <span class="font-medium text-slate-900 dark:text-white">dashboard.html</span>
                                </div>
                                <p class="text-sm text-slate-500 dark:text-slate-400 mb-3">순수 JavaScript</p>
                                <code class="block text-xs font-mono text-slate-600 dark:text-slate-300 bg-slate-100 dark:bg-slate-800 px-3 py-2 rounded">더블클릭으로 열기</code>
                                <p class="text-xs text-slate-400 mt-2">바로 실행 가능</p>
                            </div>
                            <div>
                                <div class="flex items-center gap-3 mb-3">
                                    <span class="text-xs font-mono text-slate-400">C</span>
                                    <span class="font-medium text-slate-900 dark:text-white">next-app/</span>
                                </div>
                                <p class="text-sm text-slate-500 dark:text-slate-400 mb-3">Next.js (빌드 시 변환)</p>
                                <code class="block text-xs font-mono text-slate-600 dark:text-slate-300 bg-slate-100 dark:bg-slate-800 px-3 py-2 rounded">npm run dev</code>
                                <p class="text-xs text-slate-600 dark:text-slate-300 mt-2 font-medium">권장</p>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </main>
    <script>
        const data = window.CHEMI_DATA || {};
        const config = window.SUBJECT_CONFIG || {};
        const TEST_ORDER = ['human', 'cat', 'dog', 'rabbit', 'hamster', 'idealType', 'plant', 'coffee', 'petMatch'];
        const tests = TEST_ORDER.filter(t => data[t]) || Object.keys(data);
        const DEFAULT_MODE = tests[0] || 'human';
        let currentMode = DEFAULT_MODE;
        let simMode = DEFAULT_MODE;

        document.addEventListener('DOMContentLoaded', () => {
            renderOverview();
            buildButtons();
            renderQuestions(currentMode);
            renderResults(currentMode);
            setSimMode(simMode);
            renderRoadmapCards();

            if (localStorage.getItem('darkMode') === 'true') {
                document.documentElement.classList.add('dark');
                updateThemeUI(true);
            }
        });

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('overlay');
            sidebar.classList.toggle('open');
            overlay.classList.toggle('hidden');
        }

        function toggleDarkMode() {
            const isDark = document.documentElement.classList.toggle('dark');
            localStorage.setItem('darkMode', isDark);
            updateThemeUI(isDark);
        }

        function updateThemeUI(isDark) {
            document.getElementById('theme-icon').textContent = isDark ? '??' : '??';
            document.getElementById('theme-text').textContent = isDark ? '다크 모드' : '라이트 모드';
        }

        function showTab(tabName) {
            document.querySelectorAll('.tab-panel').forEach(p => p.classList.add('hidden'));
            document.querySelectorAll('.nav-item').forEach(b => {
                b.classList.remove('active');
                b.classList.add('text-slate-600', 'dark:text-slate-300');
            });
            const panel = document.getElementById(`panel-${tabName}`);
            if (panel) {
                panel.classList.remove('hidden');
                panel.classList.add('animate-fade-in');
            }
            const nav = document.getElementById(`nav-${tabName}`);
            if (nav) {
                nav.classList.add('active');
                nav.classList.remove('text-slate-600', 'dark:text-slate-300');
            }
            if (window.innerWidth < 768) toggleSidebar();
        }

        function buildButtons() {
            const targets = [
                { id: 'management-modes', handler: showManagementMode },
                { id: 'logic-modes', handler: showLogicMode },
                { id: 'sim-modes', handler: setSimMode },
            ];
            targets.forEach(target => {
                const container = document.getElementById(target.id);
                if (!container) return;
                container.innerHTML = tests.map((key, idx) => {
                    const meta = getTestMeta(key);
                    const active = idx === 0 ? 'active' : 'bg-slate-200 dark:bg-slate-700 text-slate-600 dark:text-slate-300';
                    return `<button onclick="${target.handler.name}('${key}')" id="${target.id}-${key}" class="mode-btn ${active} px-4 py-2 rounded-xl font-medium transition text-sm">${meta.emoji} ${meta.label}</button>`;
                }).join('');
            });
        }

        function renderOverview() {
            let totalQuestions = 0;
            let totalResults = 0;
            let personality = 0;
            let matching = 0;
            const grid = document.getElementById('overview-test-grid');
            let html = '';

            tests.forEach(test => {
                const d = data[test] || {};
                const cfg = config[test] || {};
                const questions = (d.questions || []).length + (d.questions_deep || []).length;
                const results = (d.resultLabels || []).length;
                const meta = getTestMeta(test);
                totalQuestions += questions;
                totalResults += results;
                if (cfg.testType === 'matching' || d.testType === 'matching') matching++; else personality++;

                html += `
                    <div class="stat-card glass rounded-2xl p-5 animate-slide-up border border-slate-200 dark:border-slate-700">
                        <div class="flex items-center gap-3 mb-3">
                            <div class="w-10 h-10 rounded-xl ${meta.color} text-white flex items-center justify-center text-xl">${meta.emoji}</div>
                            <div>
                                <div class="text-xs text-slate-500 dark:text-slate-400">${meta.typeLabel}</div>
                                <div class="font-bold text-slate-800 dark:text-white">${meta.label}</div>
                            </div>
                        </div>
                        <div class="flex items-end justify-between">
                            <div class="text-2xl font-bold text-slate-800 dark:text-white">${questions}</div>
                            <span class="text-xs text-slate-500">${results}개 결과</span>
                        </div>
                    </div>
                `;
            });

            document.getElementById('stat-total').textContent = totalQuestions;
            document.getElementById('stat-tests').textContent = `${tests.length}개 테스트`;
            document.getElementById('stat-results').textContent = `${totalResults}개 결과`;
            document.getElementById('stat-personality').textContent = `${personality} 성격형`;
            document.getElementById('stat-matching').textContent = `${matching} 매칭형`;
            if (grid) grid.innerHTML = html;
        }

        function renderQuestions(mode) {
            const questions = [...(data[mode]?.questions || []), ...(data[mode]?.questions_deep || [])];
            const dims = data[mode]?.dimensions || {};
            let html = '';
            let idx = 0;
            questions.forEach(q => {
                idx++;
                const dimInfo = dims[q.dimension] || { emoji: '❔', name: q.dimension };
                html += `
                    <tr class="table-row border-b border-slate-100 dark:border-slate-700">
                        <td class="px-4 py-4 text-sm text-slate-600 dark:text-slate-300">${idx}</td>
                        <td class="px-4 py-4"><span class="px-2.5 py-1 rounded-full bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-300 text-xs font-bold">${q.is_deep ? '심화' : '기본'}</span></td>
                        <td class="px-4 py-4 text-sm text-slate-700 dark:text-slate-200">${dimInfo.emoji} ${dimInfo.name}</td>
                        <td class="px-4 py-4 text-sm text-slate-700 dark:text-slate-200">${q.q}</td>
                        <td class="px-4 py-4 text-xs">${q.a.map(a => `<div class=\"flex items-center gap-2 mb-1\"><span class=\"px-2 py-0.5 rounded-full bg-slate-100 dark:bg-slate-700 text-slate-700 dark:text-slate-200\">${a.text}</span><span class=\"px-2 py-0.5 rounded-full bg-indigo-100 dark:bg-indigo-900 text-indigo-700 dark:text-indigo-300 font-bold\">${a.score}</span></div>`).join('')}</td>
                    </tr>
                `;
            });
            const body = document.getElementById('management-table');
            if (body) body.innerHTML = html;
        }

        function renderResults(mode) {
            const results = data[mode]?.resultLabels || [];
            const dims = data[mode]?.dimensions || {};
            const grid = document.getElementById('logic-results-grid');
            if (!grid) return;
            let html = '';
            results.forEach(r => {
                const conditionHtml = Object.entries(r.condition || {}).map(([dim, level]) => {
                    const dimInfo = dims[dim] || { emoji: '❔', name: dim };
                    const levelColors = { high: 'bg-emerald-100 dark:bg-emerald-900 text-emerald-700 dark:text-emerald-300', medium: 'bg-amber-100 dark:bg-amber-900 text-amber-700 dark:text-amber-300', low: 'bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300' };
                    return `<span class=\"inline-block px-2 py-1 rounded-full text-xs font-medium ${levelColors[level] || ''} mr-1 mb-1\">${dimInfo.emoji} ${level.toUpperCase()}</span>`;
                }).join('');
                html += `
                    <div class="glass rounded-2xl p-5 hover:shadow-xl result-card">
                        <div class="flex items-center gap-3 mb-3">
                            <span class="text-3xl">${r.emoji || '🏷️'}</span>
                            <span class="font-bold text-lg text-slate-800 dark:text-white">${r.name}</span>
                        </div>
                        <div class="mb-3 flex flex-wrap">${conditionHtml}</div>
                        <p class="text-sm text-slate-600 dark:text-slate-300">${r.desc || ''}</p>
                    </div>
                `;
            });
            grid.innerHTML = html;
        }

        function setSimMode(mode) {
            simMode = mode;
            document.querySelectorAll('#sim-modes .mode-btn').forEach(b => {
                b.classList.remove('active');
                b.classList.add('bg-slate-200', 'dark:bg-slate-700', 'text-slate-600', 'dark:text-slate-300');
            });
            const btn = document.getElementById(`sim-modes-${mode}`);
            if (btn) {
                btn.classList.add('active');
                btn.classList.remove('bg-slate-200', 'dark:bg-slate-700', 'text-slate-600', 'dark:text-slate-300');
            }
            renderSimSliders(mode);
            document.getElementById('sim-result').innerHTML = '<p class="text-slate-400 dark:text-slate-500 text-center">슬라이더를 조절하고<br>"결과 확인"을 눌러주세요.</p>';
        }

        function renderSimSliders(mode) {
            const dims = data[mode]?.dimensions || {};
            let html = '';
            Object.entries(dims).forEach(([key, dim]) => {
                html += `
                    <div>
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-sm font-medium text-slate-700 dark:text-slate-200">${dim.emoji} ${dim.name}</span>
                            <span class="text-sm font-bold text-indigo-600 dark:text-indigo-400" id="val-${key}">50%</span>
                        </div>
                        <input type="range" id="slider-${key}" min="0" max="100" value="50" class="w-full h-2 rounded-lg cursor-pointer" oninput="document.getElementById('val-${key}').textContent = this.value + '%'"><div class="flex justify-between text-xs text-slate-400 mt-1"><span>LOW</span><span>MEDIUM</span><span>HIGH</span></div>
                    </div>
                `;
            });
            document.getElementById('sim-sliders').innerHTML = html;
        }

        function simulate() {
            const dims = data[simMode]?.dimensions || {};
            const results = data[simMode]?.resultLabels || [];
            const questions = [...(data[simMode]?.questions || []), ...(data[simMode]?.questions_deep || [])];
            const dimCounts = {};
            Object.keys(dims).forEach(dim => { dimCounts[dim] = questions.filter(q => q.dimension === dim).length || 1; });
            const scores = {};
            Object.keys(dims).forEach(dim => {
                const percentage = parseInt(document.getElementById(`slider-${dim}`).value);
                const maxScore = dimCounts[dim] * 5;
                scores[dim] = Math.round((percentage / 100) * maxScore);
            });
            const levels = {};
            Object.keys(dims).forEach(dim => {
                const maxScore = dimCounts[dim] * 5;
                const percentage = (scores[dim] / maxScore) * 100;
                if (percentage >= 60) levels[dim] = 'high';
                else if (percentage <= 40) levels[dim] = 'low';
                else levels[dim] = 'medium';
            });
            let matchedResult = null;
            let bestScore = 0;
            for (const result of results) {
                let matchCount = 0;
                let totalConditions = Object.keys(result.condition || {}).length;
                for (const [dim, level] of Object.entries(result.condition || {})) {
                    if (levels[dim] === level) matchCount++;
                }
                if (matchCount === totalConditions) { matchedResult = result; break; }
                if (matchCount > bestScore) { bestScore = matchCount; matchedResult = result; }
            }
            if (!matchedResult) {
                document.getElementById('sim-result').innerHTML = '<p class="text-center text-slate-500 dark:text-slate-400">결과를 계산할 수 없습니다.</p>';
                return;
            }
            const levelBadges = Object.entries(levels).map(([dim, level]) => {
                const dimInfo = dims[dim];
                const colors = { high: 'bg-emerald-500', medium: 'bg-amber-500', low: 'bg-red-500' };
                return `<span class="inline-flex items-center gap-1 px-2.5 py-1 ${colors[level]} text-white rounded-full text-xs font-medium mr-1 mb-1">${dimInfo.emoji} ${level.toUpperCase()}</span>`;
            }).join('');
            document.getElementById('sim-result').innerHTML = `
                <div class="text-center animate-fade-in">
                    <div class="text-6xl mb-4 animate-float">${matchedResult.emoji || '🏷️'}</div>
                    <h4 class="text-2xl font-bold text-slate-800 dark:text-white mb-4">${matchedResult.name}</h4>
                    <div class="mb-4 flex flex-wrap justify-center">${levelBadges}</div>
                    <p class="text-slate-600 dark:text-slate-300">${matchedResult.desc || ''}</p>
                </div>
            `;
        }

        function showManagementMode(mode) {
            currentMode = mode;
            updateActiveButtons('management-modes', mode);
            renderQuestions(mode);
        }

        function showLogicMode(mode) {
            updateActiveButtons('logic-modes', mode);
            renderResults(mode);
        }

        function updateActiveButtons(containerId, mode) {
            document.querySelectorAll(`#${containerId} .mode-btn`).forEach(b => {
                b.classList.remove('active');
                b.classList.add('bg-slate-200', 'dark:bg-slate-700', 'text-slate-600', 'dark:text-slate-300');
            });
            const btn = document.getElementById(`${containerId}-${mode}`);
            if (btn) {
                btn.classList.add('active');
                btn.classList.remove('bg-slate-200', 'dark:bg-slate-700', 'text-slate-600', 'dark:text-slate-300');
            }
        }

        function renderRoadmapCards() {
            const grid = document.getElementById('roadmap-test-grid');
            if (!grid) return;
            let html = '';
            tests.forEach(test => {
                const d = data[test] || {};
                const meta = getTestMeta(test);
                const questions = (d.questions || []).length + (d.questions_deep || []).length;
                const dimsCount = Object.keys(d.dimensions || {}).length;
                html += `
                    <div class="rounded-2xl p-4 glass border border-slate-200 dark:border-slate-700">
                        <div class="flex items-center gap-3 mb-3">
                            <span class="text-2xl">${meta.emoji}</span>
                            <div>
                                <h4 class="font-bold text-slate-800 dark:text-white text-sm">${meta.label}</h4>
                                <span class="text-xs text-emerald-600 dark:text-emerald-400">운영 중</span>
                            </div>
                        </div>
                        <p class="text-xs text-slate-500 mb-2">${meta.typeLabel}</p>
                        <div class="flex gap-1 flex-wrap">
                            <span class="px-2 py-0.5 rounded bg-slate-100 dark:bg-slate-800 text-slate-700 dark:text-slate-200 text-xs">${dimsCount}차원</span>
                            <span class="px-2 py-0.5 rounded bg-slate-100 dark:bg-slate-800 text-slate-700 dark:text-slate-200 text-xs">${questions}문항</span>
                        </div>
                    </div>
                `;
            });
            grid.innerHTML = html;
        }

        function getTestMeta(key) {
            const cfg = config[key] || {};
            const emojiMap = { human: '🧑', cat: '🐱', dog: '🐶', rabbit: '🐰', hamster: '🐹', idealType: '💖', plant: '🌿', coffee: '☕', petMatch: '🐾' };
            const colorMap = { human: 'bg-amber-500', cat: 'bg-rose-500', dog: 'bg-emerald-500', rabbit: 'bg-pink-500', hamster: 'bg-orange-500', idealType: 'bg-pink-500', plant: 'bg-green-500', coffee: 'bg-amber-400', petMatch: 'bg-yellow-500' };
            return {
                emoji: emojiMap[key] || '🏷️',
                color: colorMap[key] || 'bg-slate-500',
                label: cfg.label || data[key]?.title || key,
                typeLabel: cfg.testType === 'matching' || data[key]?.testType === 'matching' ? '매칭형 테스트' : '성격형 테스트'
            };
        }

        async function openMarkdownViewer(filePath, title) {
            const modal = document.getElementById('markdown-modal');
            const modalTitle = document.getElementById('markdown-modal-title');
            const modalContent = document.getElementById('markdown-modal-content');
            modalTitle.textContent = title;
            modalContent.innerHTML = '<div class="flex items-center justify-center py-12"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"></div><span class="ml-3 text-slate-500">문서를 불러오는 중...</span></div>';
            modal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
            try {
                const response = await fetch(filePath);
                if (!response.ok) throw new Error('파일을 찾을 수 없습니다.');
                const markdown = await response.text();
                modalContent.innerHTML = marked.parse(markdown);
            } catch (error) {
                modalContent.innerHTML = `<div class="text-center py-12 text-red-500"><span class="text-4xl block mb-4">:(</span><p>문서를 불러올 수 없습니다.</p><p class="text-sm text-slate-400 mt-2">${error.message}</p></div>`;
            }
        }

        function closeMarkdownViewer() {
            const modal = document.getElementById('markdown-modal');
            modal.classList.add('hidden');
            document.body.style.overflow = '';
        }

        document.addEventListener('keydown', (e) => { if (e.key === 'Escape') closeMarkdownViewer(); });
    </script>

    <div id="markdown-modal" class="hidden fixed inset-0 z-50 overflow-y-auto">
        <div class="fixed inset-0 bg-black/50 backdrop-blur-sm" onclick="closeMarkdownViewer()"></div>
        <div class="relative min-h-screen flex items-center justify-center p-4">
            <div class="relative bg-white dark:bg-slate-800 rounded-2xl shadow-2xl w-full max-w-4xl max-h-[90vh] flex flex-col animate-fade-in">
                <div class="flex items-center justify-between p-4 border-b border-slate-200 dark:border-slate-700">
                    <h3 id="markdown-modal-title" class="text-lg font-bold text-slate-800 dark:text-white flex items-center gap-2">
                        <span>??</span> 문서
                    </h3>
                    <button onclick="closeMarkdownViewer()" class="p-2 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-700 transition">
                        <svg class="w-5 h-5 text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
                    </button>
                </div>
                <div id="markdown-modal-content" class="p-6 overflow-y-auto markdown-body"></div>
            </div>
        </div>
    </div>
</body>
</html>
